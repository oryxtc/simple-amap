<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        #container {
            width: 100%;
            height: 100%;
        }

        #panel2, #panel {
            position: absolute;
            background-color: white;
            max-height: 70%;
            overflow-y: auto;
            top: 10px;
            right: 10px;
            width: 280px;
        }
    </style>
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" type="text/css">

    <script type="text/javascript"
            src="https://webapi.amap.com/maps?v=1.4.15&key=d552457bea86613184225b966c3b8bef"></script>
</head>
<body>
<div id="container"></div>
<div id="panel"></div>
<div id="panel2"></div>

<div class="input-card" style='width: 24rem;'>
    <div class="input-item">
        <div class="input-item-prepend">
            <span class="input-item-text" style="width:8rem;">请输入关键字</span>
        </div>
        <input id='tipinput' type="text">
    </div>
    <div class="input-item">
        <input type="radio" name='func' checked="" value='marker'><span class="input-text">画点</span>
        <input type="radio" name='func' value='circle'><span class="input-text">画圆</span>
        <input type="radio" name='func' value='polygon'><span class="input-text" style='width:5rem;'>画多边形</span>
    </div>
    <!--    <div class="input-item">-->
    <!--        <input type="radio" name='func' value='polyline'><span class="input-text">画折线</span>-->
    <!--        <input type="radio" name='func' value='rectangle'><span class="input-text">画矩形</span>-->
    <!--    </div>-->
    <div class="input-item">
        <input id="clear" type="button" class="btn" value="清除"/>
        <input id="close" type="button" class="btn" value="关闭绘图"/>
    </div>
    <div class="input-item">
        <input type="button" class="btn" id='default' value="默认样式测距" style='margin-right:1rem;'/>
        <input type="button" class="btn" id='custom' value="自定义样式测距"/>
    </div>
</div>
</body>
<script type="application/javascript">
    var map = new AMap.Map('container', {
        zoom: 13,//级别
        center: [104.054779, 30.564523],//中心点坐标
        viewMode: '3D'//使用3D视图
    });

    // 同时引入工具条插件，比例尺插件和鹰眼插件
    AMap.plugin([
        'AMap.ToolBar',
        'AMap.Scale',
        'AMap.OverView',
        'AMap.MapType',
        'AMap.Geolocation',
        'AMap.RangingTool',
        'AMap.MouseTool',
        'AMap.Autocomplete',
        'AMap.PlaceSearch',
    ], function () {
        // 在图面添加工具条控件，工具条控件集成了缩放、平移、定位等功能按钮在内的组合控件
        map.addControl(new AMap.ToolBar());
        // 在图面添加比例尺控件，展示地图在当前层级和纬度下的比例尺
        map.addControl(new AMap.Scale());
        // 在图面添加定位控件，用来获取和展示用户主机所在的经纬度位置
        map.addControl(new AMap.Geolocation());
        map.addControl(new AMap.RangingTool());
        map.addControl(new AMap.MouseTool());
        map.addControl(new AMap.Autocomplete());
        map.addControl(new AMap.PlaceSearch());
    });


    //矢量图编辑
    var mouseTool = new AMap.MouseTool(map);
    //监听draw事件可获取画好的覆盖物
    var overlays = [];
    mouseTool.on('draw', function (e) {
        overlays.push(e.obj);
    })

    function draw(type) {
        switch (type) {
            case 'marker': {
                mouseTool.marker({
                    //同Marker的Option设置
                });
                break;
            }
            case 'polyline': {
                mouseTool.polyline({
                    strokeColor: '#80d8ff'
                    //同Polyline的Option设置
                });
                break;
            }
            case 'polygon': {
                mouseTool.polygon({
                    fillColor: '#00b0ff',
                    strokeColor: '#80d8ff'
                    //同Polygon的Option设置
                });
                break;
            }
            case 'rectangle': {
                mouseTool.rectangle({
                    fillColor: '#00b0ff',
                    strokeColor: '#80d8ff'
                    //同Polygon的Option设置
                });
                break;
            }
            case 'circle': {
                mouseTool.circle({
                    fillColor: '#00b0ff',
                    strokeColor: '#80d8ff'
                    //同Circle的Option设置
                });
                break;
            }
        }
    }

    var radios = document.getElementsByName('func');
    for (var i = 0; i < radios.length; i += 1) {
        radios[i].onchange = function (e) {

            draw(e.target.value)
        }
    }
    draw('marker')

    document.getElementById('clear').onclick = function () {
        map.remove(overlays)
        overlays = [];
    }
    document.getElementById('close').onclick = function () {
        mouseTool.close(true)//关闭，并清除覆盖物
        for (var i = 0; i < radios.length; i += 1) {
            radios[i].checked = false;
        }
    }

    // 地图测距
    var ruler1, ruler2;

    //默认样式
    ruler1 = new AMap.RangingTool(map);

    //自定义样式
    var startMarkerOptions = {
        icon: new AMap.Icon({
            size: new AMap.Size(19, 31),//图标大小
            imageSize: new AMap.Size(19, 31),
            image: "https://webapi.amap.com/theme/v1.3/markers/b/start.png"
        })
    };
    var endMarkerOptions = {
        icon: new AMap.Icon({
            size: new AMap.Size(19, 31),//图标大小
            imageSize: new AMap.Size(19, 31),
            image: "https://webapi.amap.com/theme/v1.3/markers/b/end.png"
        }),
        offset: new AMap.Pixel(-9, -31)
    };
    var midMarkerOptions = {
        icon: new AMap.Icon({
            size: new AMap.Size(19, 31),//图标大小
            imageSize: new AMap.Size(19, 31),
            image: "https://webapi.amap.com/theme/v1.3/markers/b/mid.png"
        }),
        offset: new AMap.Pixel(-9, -31)
    };
    var lineOptions = {
        strokeStyle: "solid",
        strokeColor: "#FF33FF",
        strokeOpacity: 1,
        strokeWeight: 2
    };
    var rulerOptions = {
        startMarkerOptions: startMarkerOptions,
        midMarkerOptions: midMarkerOptions,
        endMarkerOptions: endMarkerOptions,
        lineOptions: lineOptions
    };
    ruler2 = new AMap.RangingTool(map, rulerOptions);

    //启用默认样式测距
    document.getElementById('default').onclick = function () {
        ruler2.turnOff();
        ruler1.turnOn();
    }
    //启用自定义样式测距
    document.getElementById('custom').onclick = function () {
        ruler1.turnOff();
        ruler2.turnOn();
    }


    var clickHandler = function (e) {
        AMap.service(["AMap.PlaceSearch"], function () {
            //构造地点查询类
            var placeSearch = new AMap.PlaceSearch({
                type: '幼儿园|托育|托管', // 兴趣点类别
                pageSize: 5, // 单页显示结果条数
                pageIndex: 1, // 页码
                city: "028", // 兴趣点城市
                citylimit: true,  //是否强制限制在设置的城市内搜索
                map: map, // 展现结果的地图实例
                panel: "panel", // 结果列表将在此容器中进行展示。
                autoFitView: false // 是否自动调整地图视野使绘制的 Marker点都处于视口的可见范围
            });
            document.getElementById('panel').style.display = "block";
            document.getElementById('panel2').style.display = "none";
            var cpoint = [e.lnglat.getLng(), e.lnglat.getLat()]; //中心点坐标
            placeSearch.searchNearBy('成都', cpoint, 1000, function (status, result) {
            });
        });
    };

    // 绑定事件
    map.on('click', clickHandler)

    document.getElementById('tipinput').onkeypress = function (e) {
        if (e.key === 'Enter') {
            AMap.service(["AMap.PlaceSearch"], function () {
                //构造地点查询类
                var placeSearch = new AMap.PlaceSearch({
                    pageSize: 5, // 单页显示结果条数
                    pageIndex: 1, // 页码
                    city: "028", // 兴趣点城市
                    citylimit: true,  //是否强制限制在设置的城市内搜索
                    map: map, // 展现结果的地图实例
                    panel: "panel2", // 结果列表将在此容器中进行展示。
                    autoFitView: true, // 是否自动调整地图视野使绘制的 Marker点都处于视口的可见范围
                    showCover: false // 是否自动调整地图视野使绘制的 Marker点都处于视口的可见范围
                });
                document.getElementById('panel').style.display = "none";
                document.getElementById('panel2').style.display = "block";
                //关键字查询
                placeSearch.search(e.target.value);
            });
        }

    }

</script>

</html>